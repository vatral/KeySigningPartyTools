#!/usr/bin/perl -w
# Key signing party list generator
# Copyright (C) 2013 Vadim Troshchinskiy <me@vadim.ws>
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#   
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.

use strict;
use KeySigningParty::KeyList::FOSDEM;
use KeySigningParty::Output::PDF;
use KeySigningParty::VisualHash::QRCode;
use KeySigningParty::VisualHash::Vash;
use Getopt::Long;

my $input_file;
my $output_file;

GetOptions(
	"output|o=s" => \$output_file) or die "Getopt failed: $!";
$input_file = shift @ARGV;
die "Input file required" unless ($input_file);
die "Output file required" unless ($output_file);



$| = 1;
my $list = new KeySigningParty::KeyList::FOSDEM();
$list->load($input_file);

foreach my $ent (@{$list->entries}) {
	print $ent->as_string . "\n";
}

my $qr   = new KeySigningParty::VisualHash::QRCode();
my $vash = new KeySigningParty::VisualHash::Vash();

my $out = new KeySigningParty::Output::PDF( list => $list, visual_hashes => [ $qr, $vash ] );
$out->generate($output_file);
